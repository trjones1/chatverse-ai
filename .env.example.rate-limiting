# Rate Limiting Configuration for Multi-Character AI Chat Platform

# Redis Configuration (Production - Recommended)
# Use Redis for distributed rate limiting across multiple serverless instances
REDIS_URL=redis://your-redis-instance:6379
# Alternative: Redis with auth
# REDIS_URL=redis://:password@your-redis-instance:6379

# Vercel Edge Config (Optional - For dynamic rate limit updates)
# Create an Edge Config store in Vercel dashboard
EDGE_CONFIG=https://edge-config.vercel.com/stores/your-store-id/token/your-token

# Admin IP Allowlist (Comma-separated IPs that bypass admin rate limits)
ADMIN_IP_ALLOWLIST=127.0.0.1,::1,192.168.1.100,10.0.0.5

# Rate Limiting Overrides (Optional)
# Override default rate limits for specific endpoints
# Format: RATE_LIMIT_{ENDPOINT}_{TIER}={requests},{window_seconds},{max_violations},{block_duration}
RATE_LIMIT_CHAT_ANONYMOUS=10,86400,3,3600
RATE_LIMIT_CHAT_FREE=20,86400,5,1800
RATE_LIMIT_CHAT_PAID=2000,86400,10,300
RATE_LIMIT_VOICE_PAID=200,3600,5,900
RATE_LIMIT_API_GENERAL=500,3600,15,600
RATE_LIMIT_PAYMENT_CHECKOUT=3,300,2,7200
RATE_LIMIT_ADMIN_ANALYTICS=25,3600,3,3600

# Character-specific Rate Limits (Per character)
# These apply in addition to user-tier limits
RATE_LIMIT_CHARACTER_SELFIE=15,3600,3,1800
RATE_LIMIT_CHARACTER_MEMORY=100,3600,5,900

# Fraud Detection Settings
FRAUD_DETECTION_ENABLED=true
FRAUD_DETECTION_RISK_THRESHOLD=70
FRAUD_DETECTION_BLOCK_THRESHOLD=85

# Rate Limiting Monitoring
# Send rate limit violations to Sentry/logging service
RATE_LIMIT_MONITORING_ENABLED=true
RATE_LIMIT_ALERT_THRESHOLD=100

# Development Settings
# Disable rate limiting in development (not recommended for staging/production)
DISABLE_RATE_LIMITING=false
# Use in-memory store only (for development without Redis)
FORCE_MEMORY_RATE_LIMITING=false

# Edge Config Schema for Dynamic Updates
# Use this structure in your Vercel Edge Config:
# {
#   "rateLimit:chat:anonymous": { "requests": 5, "window": 86400, "maxViolations": 3, "blockDuration": 3600 },
#   "rateLimit:voice:paid": { "requests": 100, "window": 3600, "maxViolations": 5, "blockDuration": 900 },
#   "adminIpAllowlist": ["127.0.0.1", "::1", "your-admin-ip"]
# }